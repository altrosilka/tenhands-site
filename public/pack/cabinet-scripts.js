angular.module("Cabinet",["ui.router","ui.select","ngSanitize","ngCookies","ngAnimate","ui.bootstrap","ui.calendar","templates","LocalStorageModule"]),angular.module("Cabinet").config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(e,t,n,a){a.defaults.withCredentials=!0,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"],a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=utf8",a.defaults.transformRequest=[function(e){var t=function(e){var n,a,r,o,s,i,c="";for(n in e)if(a=e[n],a instanceof Array)for(i=0;i<a.length;++i)o=a[i],r=n+"["+i+"]",s={},s[r]=o,c+=t(s)+"&";else if(a instanceof Object)for(subName in a)o=a[subName],r=n+"["+subName+"]",s={},s[r]=o,c+=t(s)+"&";else void 0!==a&&null!==a&&(c+=encodeURIComponent(n)+"="+encodeURIComponent(a)+"&");return c.length?c.substr(0,c.length-1):c};return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}],n.html5Mode(!0).hashPrefix("!"),t.otherwise("/login"),e.state("login",{url:"/login",controller:"CV_login as ctr",templateUrl:"templates/views/login.html"}),e.state("index",{url:"/?successEmail&successRestore",controller:"CV_index as ctr",templateUrl:"templates/views/index.html"}),e.state("public",{url:"/public/","abstract":!1,templateUrl:"templates/views/public/index.html"}).state("public.sets",{url:"sets/",controller:"CV_public_sets as ctr",templateUrl:"templates/views/public/sets.html"}).state("public.accounts",{url:"accounts/?error&network&success&account",controller:"CV_public_accounts as ctr",templateUrl:"templates/views/public/accounts.html",resolve:{_accounts:["S_selfapi",function(e){return e.getUserAccounts()}]}}).state("public.history",{url:"history/?set_id",controller:"CV_public_history as ctr",templateUrl:"templates/views/public/history.html"}).state("public.team",{url:"team/",controller:"CV_public_team as ctr",templateUrl:"templates/views/public/team.html"}).state("public.table",{url:"table/",controller:"CV_public_table as ctr",templateUrl:"templates/views/public/table.html"}),e.state("analytic",{url:"/analytic/",templateUrl:"templates/views/analytic/index.html"}).state("analytic.sandbox",{url:"sandbox/?branch&branches&from&to&param&param2",controller:"CV_analytic_sandbox as ctr",templateUrl:"templates/views/analytic/sandbox.html",reloadOnSearch:!1}),e.state("account",{url:"/account/",templateUrl:"templates/views/account/index.html"}).state("account.plan",{url:"plan/",controller:"CV_account_plan as ctr",templateUrl:"templates/views/account/plan.html",reloadOnSearch:!1})}]),angular.module("Cabinet").constant("__afterLoginUrl","/cabinet/").constant("__timezone",6).constant("__api",{baseUrl:"https://10hands.io/api/",paths:{loadVkAccountGroups:"social/vk/loadAdminGroups",loadFbAccountGroups:"social/fb/loadAdminGroups","channels/toggleDisableState":"channels/toggleDisableState","sets/attachUserByEmail":"sets/attachUserByEmail/","sets/attachUserById":"sets/attachUserById","sets/detachUserById":"sets/removeUserFromSet",addVkGroup:"channels/vk",addFbGroup:"channels/fb",addOkGroup:"channels/ok",addIgAccount:"channels/ig",signIn:"auth/signin",signUp:"auth/signup",signOut:"auth/signout",accounts:"accounts",sets:"sets",channels:"channels",getUserInfo:"users/getCurrentUser",getUserState:"users/getState",setUserName:"users/setUserName",setUserCompanyName:"users/setUserCompanyName",setUserPassword:"users/setUserPassword",getVkToken:"vkToken",getTwitterAuthUrl:"auth/twitter/getUrl",getVkAuthUrl:"auth/vk/getUrl",extension:{afterInstall:"/pages/afterInstall.html"},getVkWallPosts:"analytic/getWallPosts",getPostingHistory:"postingHistory",getUserSetsTeam:"sets/getTeam",restorePassword:"auth/restorePassword",getTable:"table",getPricingPlans:"payments/getPlans"}}).constant("__extensionId","oejjcepegjobphogjdihoahgoekjimkl").value("_timezone",6),angular.module("Cabinet").run(["$state","S_selfapi","S_eventer",function(e,t,n){t.getUserInfo().then(function(e){n.sendEvent("disableLoader"),n.sendEvent("setUserName",e.data.name||e.data.email)},function(){n.sendEvent("disableLoader")})}]),angular.module("Cabinet").controller("C_cabinet",["$scope","$state","$timeout","S_selfapi","S_vk",function(e,t,n,a){var r=this;return e.$on("showAddExtensionLayer",function(){r.showAddExtensionLayer=!0}),e.$on("setUserName",function(e,t){r.userName=t}),e.$on("state:userRecieved",function(){r.disableLoader=!0}),e.$on("disableLoader",function(){r.disableLoader=!0}),r.logout=function(){a.signOut().then(function(){t.go("login")})},r.getMainState=function(){return t.current.name.split(".")[0]},r}]),angular.module("Cabinet").controller("CV_login",["S_selfapi","S_eventer","$state","$timeout",function(e,t,n){var a=this;return a.email=a.password="",a.auth=function(r,o){a.authInProgress||(a.authInProgress=!0,a.error=!1,e.signIn(r,o).then(function(e){a.authInProgress=!1,n.go("index"),t.sendEvent("setUserName",e.data.name)},function(){a.authInProgress=!1,a.error=!0}))},a.toggleRestorePassword=function(){a.restoreMode=!a.restoreMode},a.restore=function(t){a.authInProgress||(a.authInProgress=!0,a.error=!1,e.restorePassword(t).then(function(){a.authInProgress=!1,a.successRestore=!0},function(){a.authInProgress=!1,a.error=!0}))},a}]),angular.module("Cabinet").directive("customSelect",function(){return{transclude:!0,scope:{selectId:"=customSelect",closeOnSelect:"=",options:"=",sectionFormat:"=",sectionDefault:"=",optionFormat:"=",optionDisabled:"&",optionActive:"&",onSelect:"&",options:"=",customContent:"="},controller:"CD_customSelect as cSCtr",templateUrl:"templates/directives/customSelect.html",link:function(e,t,n,a,r){var o=e.$parent.$new(),s=e;r(o,function(e,n){n.$close=s.cSCtr.close,t.find('[data-role="custom-content"]').append(e)}),t.find("menu").on("click",function(e){e.stopPropagation()})}}}),angular.module("Cabinet").directive("dateInterval",["$filter","_timezone",function(e,t){return{scope:{start:"=",end:"=",format:"="},templateUrl:"templates/directives/dateInterval.html",link:function(n){var a=n.format||"dd.MM.yyyy";n.$watch(function(){return n.start},function(){n.filteredStart=e("date")(n.start,a,t)}),n.$watch(function(){return n.end},function(){n.filteredEnd=e("date")(n.end,a,t)})}}}]),angular.module("Cabinet").directive("member",[function(){return{scope:{member:"=",guestAccess:"="},templateUrl:"templates/directives/member.html",link:function(){},controller:["$scope","S_selfapi","S_utils",function(e,t){var n=this,a=e.member.sets_ids?e.member.sets_ids.length:0;n.getName=function(){return e.member.name?e.member.name+" / "+e.member.email:e.member.email},n.setsPlural={0:"нет наборов",one:"{} набор",few:"{} набора",many:"{} наборов",other:"{} набора"},n.getSetsCount=function(){return a},n.getSetClass=function(e){var t={};return e.disabled&&(t.disabled=!0),t},n.open=function(){n.activeMode=!0,t.loadSetFullInfo(e.member.sets_ids.join(",")).then(function(e){n.sets=e.data})},n.toggleUserFromSet=function(n){n.disabled=!n.disabled,n.disabled?(a-=1,t.detachUserFromSet(e.member.id,n.id).then(function(e){console.log(e.data)})):(a+=1,t.attachUserToSet(e.member.id,n.id).then(function(){}))}}],controllerAs:"ctr"}}]),angular.module("Cabinet").directive("notifyPanel",["notifyPanel_service",function(e){return{scope:{id:"@notifyPanel"},link:function(t,n){e.checkId(t.id)||n.show().prepend('<span class="closer ion-close-round" data-close-notify></span>').find("[data-close-notify]").on("click",function(){n.remove(),e.trackId(t.id)})}}}]).service("notifyPanel_service",["localStorageService",function(e){var t={},n="notifyPanel_ids";return t.checkId=function(t){var a=e.get(n)||{};return a[t]},t.trackId=function(t){var a=e.get(n)||{};a[t]=1,e.set(n,a)},t}]),angular.module("Cabinet").directive("sandboxChart",["S_calculation","_colors",function(){return{scope:{categories:"=",metaInfo:"=",colors:"=",axis:"=",series:"="},link:function(e,t){function n(){var e={chart:{animation:{duration:2500,easing:"easeOutBounce"}},title:{text:""},subtitle:{text:""},plotOptions:{line:{marker:{enabled:!0,radius:3,symbol:"circle"},lineWidth:1}},tooltip:{shared:!0,backgroundColor:"#fff",formatter:function(){},useHTML:!0,borderColor:"transparent",backgroundColor:"transparent",borderRadius:0,shadow:!1},legend:{enabled:!1}};t.find(".chart").highcharts(e).find('text:contains("Highcharts.com")').remove()}e.$watch("series",function(t){t&&n(e.series)})}}}]),angular.module("Cabinet").directive("set",[function(){return{scope:{set:"=",guestAccess:"="},templateUrl:"templates/directives/set.html",link:function(){},controller:["$scope","S_selfapi","S_utils",function(e,t,n){var a=this;a.addNewUser=function(e){e&&""!==e&&(t.attachUserToSetByEmail(a.openedSet.id,e).then(function(){a.loadSetInfo(a.openedSet)}),a.newUserEmail="")},a.openSet=function(e,t){a.activeMode!==t&&(a.activeMode=t,delete a.openedSetChannels,a.openedSet=e,a.loadSetInfo(e))},a.setNewName=function(n){return a.errorInName=!1,n.length<3?void(a.errorInName=!0):void t.editSetProperty(e.set.id,"name",n).then(function(){})},a.onNameKeyup=function(e){a.errorInName=!1,e.length<3&&(a.errorInName=!0)},a.addChannel=function(e,t){n.openAddChannelDialog(e,t.id).then(function(){a.loadSetInfo(a.openedSet)})},a.toggleChannel=function(e){e.disabled=!e.disabled,t.toggleChannel(e.id,a.openedSet.id,e.disabled).then(function(e){console.log(e.data)})},a.toggleUser=function(e){e.disabled=!e.disabled,e.disabled?t.detachUserFromSet(e.id,a.openedSet.id).then(function(e){console.log(e.data)}):t.attachUserToSet(e.id,a.openedSet.id).then(function(){})},a.loadSetInfo=function(e){t.loadSetFullInfo(e.id).then(function(e){a.openedSetChannels=e.data[0].channels,a.openedSetUsers=e.data[0].users})},a.channelsPlural={0:"нет каналов",one:"{} канал",few:"{} канала",many:"{} каналов",other:"{} канала"},a.usersPlural={0:"нет пользователей",one:"{} пользователь",few:"{} пользователя",many:"{} пользователей",other:"{} пользователя"},a.getChannelsCount=function(e){return e?e.length:0},a.getUsersCount=function(e){return e?e.length:0},a.setIsAvtive=function(e){return a.openedSet.id===e.id},a.getChannelClass=function(e){var t={};return t[e.network]=!0,e.disabled&&(t.disabled=!0),t},a.getUserClass=function(e){var t={};return t[e.network]=!0,e.verified_email&&(t.verified=!0),e.not_confirmed&&(t.notConfirmed=!0),e.disabled&&(t.disabled=!0),t},a.getNetworkIconClass=function(e){var t={};switch(e){case"vk":t["fa-vk"]=!0;break;case"fb":t["fa-facebook"]=!0;break;case"tw":t["fa-twitter"]=!0;break;case"ig":t["fa-instagram"]=!0}return t},a.getChannelLink=function(e,t){return n.getChannelLink(e,t)}}],controllerAs:"ctr"}}]),angular.module("parseVkUrls",[]).filter("parseVkUrls",[function(){return function(e,t){if(e){for(var n=/\[club([0-9]*)\|([^\]]*)\]/g,a=/\[id([0-9]*)\|([^\]]*)\]/g,r=[],o=0;o<e.length;++o)r.push(e.charCodeAt(o));e=emojiParseInText(e);var s=e.autoLink();return s=t?s.replace(n,"<span>$2</span>"):s.replace(n,'<a class="link" href="/public/$1/">$2</a>'),s=s.replace(a,"<span>$2</span>").replace(/\n/g,"<br />")}}}]),angular.module("Cabinet").filter("propsFilter",function(){return function(e,t){var n=[];return angular.isArray(e)?e.forEach(function(e){for(var a=!1,r=Object.keys(t),o=0;o<r.length;o++){var s=r[o],i=t[s].toLowerCase();if(-1!==e[s].toString().toLowerCase().indexOf(i)){a=!0;break}}a&&n.push(e)}):n=e,n}}),angular.module("Cabinet").service("S_enviroment",["$q","$http","__extensionId",function(e,t,n){var a={};return a.extensionIsset=function(){var a=e.defer();return t({withCredentials:!1,url:"chrome-extension://"+n+"/pages/createPost.html",method:"GET"}).then(function(){a.resolve(!0)},function(){a.resolve(!1)}),a.promise},a.callExtensionVkAuth=function(){window.open("chrome-extension://"+n+"/pages/authVk.html","_blank")},a.onPostMessage=function(e){var t=window.addEventListener?"addEventListener":"attachEvent",n=window[t],a="attachEvent"==t?"onmessage":"message";n(a,function(t){var n=t.message?"message":"data",a=t[n];e(t,a)},!1)},a}]),angular.module("Cabinet").service("S_eventer",["$rootScope",function(e){var t={};return t.sendEvent=function(t,n){e.$broadcast(t,n)},t}]),angular.module("Cabinet").service("S_location",["$location",function(e){var t={};return t.setFromTo=function(t,n){t="string"==typeof t?t:moment(t).format("YYYYMMDD"),n="string"==typeof n?n:moment(n).format("YYYYMMDD"),e.search(angular.extend(e.$$search,{from:t,to:n}))},t.setAttr=function(t,n){var a={};a[t]=n,e.search(angular.extend(e.$$search,a))},t}]),angular.module("Cabinet").service("S_mapping",[function(){var e={};return e}]),angular.module("Cabinet").service("S_selfapi",["$http","$q","$state","S_eventer","__api",function(e,t,n,a,r){function o(r,o,s,i){var c=t.defer();return e({url:l+o,method:r,withCredentials:!0,data:i,params:s}).then(function(e){c.resolve(e)}).catch(function(e){return 401===e.status&&"login"!==n.current.name?(n.go("login"),void a.sendEvent("disableLoader")):void c.reject(e)}),c.promise}function s(e,t){return o("post",e,void 0,t)}function i(e,t){return o("get",e,t)}var c={},l=r.baseUrl;return c.getUserState=function(){return i(r.paths.getUserState)},c.setUserName=function(e){return s(r.paths.setUserName,{name:e})},c.getTable=function(e,t){return i(r.paths.getTable,{from:e,to:t})},c.getPostingHistory=function(e){return i(r.paths.getPostingHistory,{set_id:e})},c.setUserPassword=function(e){return s(r.paths.setUserPassword,e)},c.setUserCompanyName=function(e){return s(r.paths.setUserCompanyName,{company:e})},c.getUserInfo=function(){return i(r.paths.getUserInfo)},c.signOut=function(){return i(r.paths.signOut)},c.signIn=function(e,t){return s(r.paths.signIn,{email:e,password:t})},c.signUp=function(e,t,n){return s(r.paths.signUp,{email:e,password:t,name:n})},c.addNewSet=function(e){return s(r.paths.sets,{name:e})},c.editSetProperty=function(e,t,n){var a={id:e};return a[t]=n,s(r.paths.sets,a)},c.toggleChannel=function(e,t,n){return i(r.paths["channels/toggleDisableState"],{set_id:t,id:e,disabled:n})},c.attachUserToSetByEmail=function(e,t){return i(r.paths["sets/attachUserByEmail"],{id:e,email:t})},c.attachUserToSet=function(e,t){return i(r.paths["sets/attachUserById"],{id:t,user_id:e})},c.detachUserFromSet=function(e,t){return i(r.paths["sets/detachUserById"],{id:t,user_id:e})},c.getTwitterAuthUrl=function(e){return i(r.paths.getTwitterAuthUrl,{set_id:e})},c.getVkAuthUrl=function(){return i(r.paths.getVkAuthUrl)},c.loadSetFullInfo=function(e){return i(r.paths.sets,{id:e})},c.getUserSets=function(){return i(r.paths.sets)},c.getUserAccounts=function(){return i(r.paths.accounts)},c.loadVkAccountGroups=function(e){return i(r.paths.loadVkAccountGroups,{account_id:e})},c.loadFbAccountGroups=function(e){return i(r.paths.loadFbAccountGroups,{account_id:e})},c.addOkGroup=function(e,t,n){return s(r.paths.addOkGroup,{page_id:e,set_id:t,account_id:n})},c.addVkGroup=function(e,t,n){return s(r.paths.addVkGroup,{feed_id:e,set_id:t,account_id:n})},c.addFbGroup=function(e,t,n){return s(r.paths.addFbGroup,{page_id:e,set_id:t,account_id:n})},c.restorePassword=function(e){return s(r.paths.restorePassword,{email:e})},c.getUserSetsTeam=function(){return i(r.paths.getUserSetsTeam)},c.getPricingPlans=function(){return i(r.paths.getPricingPlans)},c}]),angular.module("Cabinet").service("S_utils",["$modal",function(e){var t={};return t.openAddChannelDialog=function(t,n){switch(t){case"vk":return e.open({templateUrl:"templates/modals/addChannelVk.html",controller:"CCM_addChannelVk as ctr",size:"md",resolve:{setId:function(){return n}}}).result;case"ok":return e.open({templateUrl:"templates/modals/addChannelOk.html",controller:"CCM_addChannelOk as ctr",size:"md",resolve:{setId:function(){return n}}}).result;case"ig":return e.open({templateUrl:"templates/modals/addChannelIg.html",controller:"CCM_addChannelIg as ctr",size:"md",resolve:{setId:function(){return n}}}).result;case"tw":return e.open({templateUrl:"templates/modals/addChannelTw.html",controller:"CCM_addChannelTw as ctr",size:"md",resolve:{setId:function(){return n}}}).result;case"fb":return e.open({templateUrl:"templates/modals/addChannelFb.html",controller:"CCM_addChannelFb as ctr",size:"md",resolve:{setId:function(){return n}}}).result}},t.getChannelLink=function(e,t){switch(e){case"vk":return"https://vk.com/"+t;case"fb":return"https://www.facebook.com/"+t;case"tw":return"https://twitter.com/"+t;case"ig":return"https://instagram.com/"+t}},t}]),angular.module("Cabinet").service("S_vk",["$q","$http","S_utils",function(e,t){var n={};n.default={version:"5.26",language:"ru"};var a=[];return n.request=function(a,r,o){var s=e.defer();return n.getToken().then(function(e){var i="/method/"+a+"?access_token="+e;r.v=r.v||n.default.version,r.lang=r.lang||n.default.language;for(var c in r)"message"===c?i+="&"+c+"="+encodeURIComponent(r[c]):"object"==typeof r[c]&&r[c].length?_.forEach(r[c],function(e){i+="&"+c+"[]="+e}):i+="&"+c+"="+r[c];t.jsonp("https://api.vk.com"+i,{params:{callback:"JSON_CALLBACK"}}).then(function(e){"function"==typeof o?o(e.data):s.resolve(e.data)})}),s.promise},n.setToken=function(e){n.token=e,a.length>0&&angular.forEach(a,function(t){t.resolve(e)})},n.testRequest=function(){var t=e.defer();return n.request("users.get",{},function(e){e.response?t.resolve():t.reject()}),t.promise},n.getToken=function(){var t=e.defer();return n.token?t.resolve(n.token):a.push(t),t.promise},n}]),angular.module("ui.calendar",[]).constant("uiCalendarConfig",{calendars:{}}).controller("uiCalendarCtrl",["$scope","$timeout","$locale",function(e,t,n){var a=1,r=1,o=e.eventSources,s=e.calendarWatchEvent?e.calendarWatchEvent:angular.noop,i=function(e){var n;return e&&(n=function(){var n=arguments,a=this;t(function(){e.apply(a,n)})}),n};this.eventsFingerprint=function(e){return e._id||(e._id=r++),""+e._id+(e.id||"")+(e.title||"")+(e.url||"")+(+e.start||"")+(+e.end||"")+(e.allDay||"")+(e.className||"")+s(e)||""},this.sourcesFingerprint=function(e){return e.__id||(e.__id=a++)},this.allEvents=function(){for(var e=[],t=0,n=o.length;n>t;t++){var a=o[t];if(angular.isArray(a))e.push(a);else if(angular.isObject(a)&&angular.isArray(a.events)){var r={};for(var s in a)"_uiCalId"!==s&&"events"!==s&&(r[s]=a[s]);for(var i=0;i<a.events.length;i++)angular.extend(a.events[i],r);e.push(a.events)}}return Array.prototype.concat.apply([],e)},this.changeWatcher=function(e,t){var n,a=function(){for(var n,a,r=angular.isFunction(e)?e():e,s=[],i=0,c=r.length;c>i;i++)a=r[i],n=t(a),o[n]=a,s.push(n);return s},r=function(e,t){var n,a,r=[],o={};for(n=0,a=t.length;a>n;n++)o[t[n]]=!0;for(n=0,a=e.length;a>n;n++)o[e[n]]||r.push(e[n]);return r},o={},s=function(e,a){var s,i,c,l,u={},d=r(a,e);for(s=0,i=d.length;i>s;s++){var f=d[s];c=o[f],delete o[f];var m=t(c);m===f?n.onRemoved(c):(u[m]=f,n.onChanged(c))}var p=r(e,a);for(s=0,i=p.length;i>s;s++)l=p[s],c=o[l],u[l]||n.onAdded(c)};return n={subscribe:function(e,t){e.$watch(a,function(e,n){t&&t(e,n)===!1||s(e,n)},!0)},onAdded:angular.noop,onChanged:angular.noop,onRemoved:angular.noop}},this.getFullCalendarConfig=function(e,t){var n={};return angular.extend(n,t),angular.extend(n,e),angular.forEach(n,function(e,t){"function"==typeof e&&(n[t]=i(n[t]))}),n},this.getLocaleConfig=function(e){if(!e.lang||e.useNgLocale){var t=function(e){var t,n;t=[];for(n in e)t[n]=e[n];return t},a=n.DATETIME_FORMATS;return{monthNames:t(a.MONTH),monthNamesShort:t(a.SHORTMONTH),dayNames:t(a.DAY),dayNamesShort:t(a.SHORTDAY)}}return{}}}]).directive("uiCalendar",["uiCalendarConfig",function(e){return{restrict:"A",scope:{eventSources:"=ngModel",calendarWatchEvent:"&"},controller:"uiCalendarCtrl",link:function(t,n,a,r){function o(){var n,o=a.uiCalendar?t.$parent.$eval(a.uiCalendar):{};n=r.getFullCalendarConfig(o,e);var s=r.getLocaleConfig(n);angular.extend(s,n),d={eventSources:i},angular.extend(d,s),d.calendars=null;var c={};for(var l in d)"eventSources"!==l&&(c[l]=d[l]);return JSON.stringify(c)}var s,i=t.eventSources,c=!1,l=r.changeWatcher(i,r.sourcesFingerprint),u=r.changeWatcher(r.allEvents,r.eventsFingerprint),d=null;t.destroy=function(){s&&s.fullCalendar&&s.fullCalendar("destroy"),s=a.calendar?e.calendars[a.calendar]=$(n).html(""):$(n).html("")},t.init=function(){s.fullCalendar(d)},l.onAdded=function(e){s.fullCalendar("addEventSource",e),c=!0},l.onRemoved=function(e){s.fullCalendar("removeEventSource",e),c=!0},u.onAdded=function(e){s.fullCalendar("renderEvent",e)},u.onRemoved=function(e){s.fullCalendar("removeEvents",function(t){return t._id===e._id})},u.onChanged=function(e){e._start=$.fullCalendar.moment(e.start),e._end=$.fullCalendar.moment(e.end),s.fullCalendar("updateEvent",e)},l.subscribe(t),u.subscribe(t,function(){return c===!0?(c=!1,!1):void 0}),t.$watch(o,function(){t.destroy(),t.init()})}}}]),angular.module("Cabinet").controller("CCM_addChannelFb",["$scope","$state","$location","$modalInstance","S_vk","S_selfapi","S_enviroment","S_eventer","setId",function(e,t,n,a,r,o,s,i,c){var l=this;return l.url="",l.selectedAccount={},l.resolveAndAdd=function(){return l.error="",l.selectedPage.id&&l.selectedAccount.id?void o.addFbGroup(l.selectedPage.id,c,l.selectedAccount.id).then(function(){a.close(!0)},function(e){l.error=e.data.text}):void(l.error="выбери аккаунт и группы")},l.refreshAccounts=function(){o.getUserAccounts().then(function(e){l.accounts=_.filter(e.data,function(e){return"fb"===e.network}),l.accounts.length&&(l.selectedAccount=l.accounts[0])})},e.$watch(function(){return l.selectedAccount.id},function(e){e&&o.loadFbAccountGroups(e).then(function(e){l.pages=e.data.pages,l.selectedPage=l.pages[0]})}),l.refreshAccounts(),l}]),angular.module("Cabinet").controller("CCM_addChannelIg",["$scope","$modalInstance","S_vk","S_selfapi","S_enviroment","S_eventer","setId",function(e,t,n,a,r,o,s){var i=this;return i.url="",i.resolveAndAdd=function(){return i.error="",""===i.username?void(i.error="укажи логин"):""===i.password?void(i.error="укажи пароль"):void a.addIgAccount(i.username,i.password,s).then(function(){t.close(!0)},function(e){"enemy"===e.data.code&&(i.error="звезды сказали, что ты не являешься создателем этой группы"),"already"===e.data.code&&(i.error="группа уже добавлена")})},i}]),angular.module("Cabinet").controller("CCM_addChannelOk",["$scope","$modalInstance","S_vk","S_selfapi","S_enviroment","S_eventer","setId",function(e,t,n,a,r,o,s){var i=this;return i.selectedAccount={},i.refreshAccounts=function(){a.getUserAccounts().then(function(e){i.accounts=_.filter(e.data,function(e){return"ok"===e.network}),i.accounts.length&&(i.selectedAccount=i.accounts[0])})},i.resolveAndAdd=function(){i.error="",a.addOkGroup(i.gid,s,i.selectedAccount.id).then(function(){t.close(!0),o.sendEvent("trigger:updateChannels")},function(e){i.error=e.data.text})},i.refreshAccounts(),i}]),angular.module("Cabinet").controller("CCM_addChannelTw",["$scope","$modalInstance","S_vk","S_selfapi","S_enviroment","S_eventer","setId",function(e,t,n,a,r,o,s){var i=this;return a.getTwitterAuthUrl(s).then(function(e){i.authUrl=e.data.url}),i.onAuthStart=function(){t.close(),$(window).on("focus",function(){o.sendEvent("trigger:updateChannels"),$(window).off("focus")})},i}]),angular.module("Cabinet").controller("CCM_addChannelVk",["$scope","$state","$location","$modalInstance","S_vk","S_selfapi","S_enviroment","S_eventer","setId",function(e,t,n,a,r,o,s,i,c){var l=this;return l.url="",l.selectedAccount={},l.selectedGroup={},l.resolveAndAdd=function(){return l.error="",l.selectedGroup.id&&l.selectedAccount.id?void o.addVkGroup(l.selectedGroup.id,c,l.selectedAccount.id).then(function(){a.close(!0)},function(){l.error=resp.data.text}):void(l.error="выбери аккаунт и группы")},l.refreshAccounts=function(){o.getUserAccounts().then(function(e){l.accounts=_.filter(e.data,function(e){return"vk"===e.network}),l.accounts.length&&(l.selectedAccount=l.accounts[0])})},e.$watch(function(){return l.selectedAccount.id},function(e){e&&o.loadVkAccountGroups(e).then(function(e){l.groups=e.data.groups,l.selectedGroup=l.groups[0]})}),l.refreshAccounts(),l}]),angular.module("Cabinet").controller("CV_index",["$scope","$stateParams","S_selfapi","S_eventer","S_enviroment","$timeout",function(e,t,n,a,r){function o(){r.extensionIsset().then(function(e){s.extensionIsInstalled=e})}var s=this;return s.extensionIsInstalled=!0,s.onGoingToStore=function(){$(window).on("focus",function(){o(),$(window).off("focus")})},s.saveName=function(e){""!==e&&(s.state.reqName=!1,a.sendEvent("setUserName",e),n.setUserName(e))},s.saveUserCompany=function(e){""!==e&&(s.state.unknownCompany=!1,n.setUserCompanyName(e))},s.changePassword=function(e){""!==e&&n.setUserPassword({password:e}).then(function(){s.state.randomPassword=!1})},s.closeNotify=function(){s.showNotify=!1},n.getUserState().then(function(e){s.state=e.data}),t.successEmail&&(s.showNotify=!0,s.notifyText="E-Mail адрес успешно подтвержден!"),t.successRestore&&(s.showNotify=!0,s.notifyText="Ваш пароль сброшен"),o(),s}]),angular.module("Cabinet").controller("CD_customSelect",["$timeout","$scope","$interpolate","$sce",function(e,t,n,a){var r=this;return t.length=123,t.$watch("sectionFormat",function(){t.section=a.trustAsHtml(n("<span>"+t.sectionFormat+"</span>")(t))}),r.close=function(){r.opened=!1,$("body").off("click")},r.open=function(){r.opened=!r.opened,r.opened?e(function(){$("body").on("click",function(){t.$apply(function(){r.opened=!1}),$(this).off("click")})}):$("body").off("click")},r.isDisabled=function(e){return t.optionDisabled()?t.optionDisabled()(e,t.selectId):void 0},r.isActive=function(e){return t.optionActive()?t.optionActive()(e,t.selectId):void 0},r.selectOption=function(e,n){e.stopPropagation(),t.selected=n,t.closeOnSelect&&r.open()},r}]),angular.module("Cabinet").controller("CV_analytic_sandbox",["$timeout","$scope","$stateParams","$filter","_timezone","S_location","S_selfapi","S_utils",function(e,t,n,a,r,o,s){function i(){var e=(a("date")(c.startDate,"yyyyMMdd",r),a("date")(c.endDate,"yyyyMMdd",r),c.selectedParams[0].name),t=c.selectedParams[1].name,n=e;t&&(n+=","+t),s.getVkWallPosts("-33393308").then(function(t){var n=[],a=[];_.forEach(t.data,function(t){var n=t[e];a.push([1e3*t.date,n])}),n.push({name:"vk",data:a}),c.graph={series:n}})}var c={};c.shortState=!0,c.paramsArray=[{description:"Лайки",name:"likes"},{description:"Репосты",name:"reposts"},{description:"Комментарии",name:"comments"},{description:"ER",name:"er"}],c.selectedParams=[_.find(c.paramsArray,function(e){return e.name===(n.param||c.paramsArray[0].name)}),n.param2?_.find(c.paramsArray,function(e){return e.name===n.param2}):{}],c.selectedParams=[{},{}],c.timeIntervals=[{title:"Неделя",id:"week"},{title:"Месяц",id:"month"},{title:"Год",id:"year"}],c.selectedInterval=c.timeIntervals[0],c.selectedBranches=[],t.$watch(function(){return c.startDate.toString()+c.endDate.toString()},function(e){e&&(c.selectIntervalArea&&(c.selectedInterval={}),o.setFromTo(c.startDate,c.endDate),i())}),t.$watch(function(){return c.selectedParams[0].name},function(e){c.paramsArray&&(o.setAttr("param",e),i())}),t.$watch(function(){return c.selectedParams[1].name},function(e){c.paramsArray&&(o.setAttr("param2",e),i())}),c.endDate=n.to?moment(n.to,"YYYYMMDD").toDate():moment().add(-1,"days").toDate(),c.startDate=n.from?moment(n.from,"YYYYMMDD").toDate():moment().add(-7,"days").toDate(),c.branches=[],c.onBranchToggle=function(e,t){c.selectedBranches=t,i()},c.getColorByBranch=function(e){return S_color.getColorByPos(e.pos).light},c.getSelectPlaceholder=function(e){return"branches"!==e?c.selectedParams[e].description?c.selectedParams[e].description:"Выберите параметр":c.selectedBranches.length>0?_.find(c.selectedBranches,{id:0})&&1===c.selectedBranches.length?"Все филиалы":"Филиалов | "+c.selectedBranches.length:"Выберите филиалы"},c.selectParam=function(e,t){c.paramIsActive(e,t)?t?c.selectedParams[t]={}:c.selectedParams[+!t].name?(c.selectedParams[t]=c.selectedParams[+!t],c.selectedParams[+!t]={}):c.selectedParams[t]={}:c.selectedParams[t]=e},c.paramIsActive=function(e,t){return c.selectedParams[t].name==e.name},c.paramAlreadySelected=function(e,t){return c.selectedParams[+!t].name==e.name};var l=!0;return c.intervalClick=function(e){l=!1,e.stopPropagation(),e.preventDefault(),setTimeout(function(){l=!0},100)},c.openSelectIntervalArea=function(){c.selectIntervalArea=!0,setTimeout(function(){$("body").on("click",function(){l&&(t.$apply(function(){c.closeSelectIntervalArea()}),$("body").off("click"))})})},c.closeSelectIntervalArea=function(){c.selectIntervalArea=!1,$("body").off("click")},c.intervalIsActive=function(e){return c.selectedInterval.id===e.id},c.setInterval=function(e){switch(c.endDate=new Date,e.id){case"week":c.startDate=moment().add(-6,"days").toDate();break;case"month":c.startDate=moment().add(-1,"month").toDate();break;case"year":c.startDate=moment().add(-1,"year").toDate()}c.selectedInterval=e},c.toggleState=function(){c.shortState=!c.shortState,c.stateChangeInProgress=!0,e(function(){c.stateChangeAfter=!0,e(function(){c.stateChangeInProgress=!1,e(function(){$(window).resize(),e(function(){c.stateChangeAfter=!1},100)},100)},100)},900)},c}]),angular.module("Cabinet").controller("CV_account_plan",["S_selfapi","S_utils",function(e){var t={};return t.pricingPlan={},e.getPricingPlans().then(function(e){t.plans=e.data.plans,t.pricingPlan=_.find(t.plans,function(t){return t.id===e.data.pricing_plan}),t.paidUntil=e.data.paid_until}),t.getCurrentPlanName=function(){return t.pricingPlan.name},t.thisIsCurrentPlan=function(e){return e.id===t.pricingPlan.id},t}]),angular.module("Cabinet").controller("CV_public_accounts",["$scope","$state","$filter","$location","S_vk","S_utils","S_enviroment","S_selfapi","S_eventer","__api","_accounts",function(e,t,n,a,r,o,s,i,c,l,u){var d=this;return d.accounts=u.data.data,d.refreshAccounts=function(){i.getUserAccounts().then(function(e){d.accounts=e.data})},d.refreshAccounts(),d.getExpiresString=function(e){return 0===e?"доступ открыт":e>0?"доступ до "+n("date")(1e3*e,"dd-MM-yyyy"):void 0},d.getAuthUrl=function(e){return l.baseUrl+"accounts/auth/"+e+"/"},d}]),angular.module("Cabinet").controller("CV_public_history",["$scope","S_vk","S_utils","S_selfapi",function(e,t,n,a){var r=this;return r.selectedSet={},a.getUserOwnSets().then(function(e){r.sets=[{id:0,name:"Все наборы"}].concat(e.data.own),r.selectedSet=r.sets[0],r.loadStat()}),r.loadStat=function(){a.getPostingHistory(r.selectedSet.id).then(function(e){r.history=e.data.history})},r}]),angular.module("Cabinet").controller("CV_public_sets",["$scope","S_vk","S_utils","S_selfapi",function(e,t,n,a){var r=this;return r.openedSet={},r.addNewSet=function(e){e&&""!==e&&(r.newSetName="",a.addNewSet(e).then(function(){r.updateSets()}))},r.updateSets=function(){a.getUserSets().then(function(e){r.sets=e.data})},r.updateSets(),r}]),angular.module("Cabinet").controller("CV_public_table",["$scope","$timeout","S_utils","S_selfapi","uiCalendarConfig",function(e,t,n,a,r){var o=this;return e.eventSources=[function(e,t,n,r){var o=e.utc().format("X"),s=t.utc().format("X");a.getTable(o,s).then(function(e){r(e.data.table)})}],e.uiConfig={calendar:{height:550,editable:!1,header:{left:"today prev,next",center:"title",right:"month,agenda10Days,agendaWeek,agenda3Days"},dayNames:["Воскресение","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayNamesShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],eventClick:e.alertOnEventClick,eventDrop:e.alertOnDrop,eventResize:e.alertOnResize,eventRender:e.eventRender,viewRender:function(){console.log(123)},slotEventOverlap:!1,timeFormat:"h:mm",columnFormat:{day:"dddd",week:"ddd, D MMM",month:"ddd"},allDaySlot:!0,slotDuration:"00:30:00",timeFormat:"H(:mm)",defaultTimedEventDuration:"00:30:00",eventLimit:!0,scrollTime:"09:00:00",views:{agenda:{eventLimit:3},agenda10Days:{type:"agenda",duration:{days:10},buttonText:"10 дней",eventLimit:2},agenda3Days:{type:"agenda",duration:{days:3},buttonText:"3 дня"}}}},e.alertOnEventClick=function(t){e.alertMessage=t.title+" was clicked "
},e.alertOnDrop=function(t,n){e.alertMessage="Event Droped to make dayDelta "+n},e.alertOnResize=function(t,n){e.alertMessage="Event Resized to make dayDelta "+n},e.eventRender=function(t,n){n.attr({tooltip:t.title,"tooltip-append-to-body":!0}),$compile(n)(e)},e.changeView=function(e,t){r.calendars[t].fullCalendar("changeView",e)},o.selectedSets=[],a.getUserSets().then(function(e){o.sets=e.data.own}),o.refreshTeam=function(){a.getUserSetsTeam().then(function(e){o.team=e.data})},o.addUserToSets=function(){if(o.selectedSets.length&&o.newUserEmail){_.map(o.selectedSets,function(e){return e.id}).join(",")}},o}]),angular.module("Cabinet").controller("CV_public_team",["$scope","S_vk","S_utils","S_selfapi",function(e,t,n,a){var r=this;return r.selectedSets=[],a.getUserSets().then(function(e){r.sets=e.data.own}),r.refreshTeam=function(){a.getUserSetsTeam().then(function(e){r.team=e.data})},r.addUserToSets=function(){if(r.selectedSets.length&&r.newUserEmail){var e=_.map(r.selectedSets,function(e){return e.id}).join(",");a.attachUserToSetByEmail(e,r.newUserEmail).then(function(){r.selectedSets=[],r.newUserEmail="",r.refreshTeam()})}},r.refreshTeam(),r}]);